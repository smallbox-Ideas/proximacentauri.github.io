<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Scorecard App</title>
    <style>
        :root {
            --primary: #1a2a6c;
            --secondary: #b21f1f;
            --accent: #fdbb2d;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .setup-screen, .toss-screen, .scorecard-screen, .innings-result-screen, .player-entry-screen {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            animation: fadeIn 0.6s ease-out;
            display: none;
        }

        .active-screen {
            display: block;
        }

        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 42, 108, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: #9a1a1a;
        }

        .btn-accent {
            background-color: var(--accent);
            color: var(--dark);
        }

        .btn-accent:hover {
            background-color: #e6a800;
        }

        .team-inputs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team-input {
            flex: 1;
        }

        .toss-options {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }

        .toss-option {
            text-align: center;
            cursor: pointer;
            padding: 20px;
            border-radius: 10px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .toss-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--accent);
        }

        .toss-option.selected {
            border-color: var(--success);
            background-color: rgba(40, 167, 69, 0.1);
        }

        .toss-option i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .toss-option h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }

        .scorecard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
        }

        .scorecard-teams {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .scorecard-teams span {
            padding: 0 10px;
        }

        .scorecard-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .scorecard-stat {
            text-align: center;
            flex: 1;
            padding: 10px;
            background-color: rgba(26, 42, 108, 0.1);
            border-radius: 5px;
            margin: 0 5px;
        }

        .scorecard-stat h3 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .scorecard-stat p {
            font-size: 0.9rem;
            color: var(--dark);
        }

        .batsmen-container {
            display: flex;
            margin-bottom: 20px;
        }

        .batsman {
            flex: 1;
            padding: 15px;
            background-color: rgba(253, 187, 45, 0.1);
            border-radius: 5px;
            margin: 0 5px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .batsman.selected {
            border-color: var(--success);
            background-color: rgba(40, 167, 69, 0.1);
        }

        .batsman-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .batsman-runs {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .bowler-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .bowler {
            display: inline-block;
            padding: 10px 20px;
            background-color: rgba(220, 53, 69, 0.1);
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .bowler.selected {
            border-color: var(--danger);
            background-color: rgba(220, 53, 69, 0.2);
        }

        .bowler-name {
            font-weight: 600;
            color: var(--secondary);
        }

        .bowler-stats {
            font-size: 0.9rem;
            color: var(--dark);
        }

        .score-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .runs-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            flex: 2;
        }

        .run-btn {
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .run-btn-0 {
            background-color: #e9ecef;
        }

        .run-btn-1 {
            background-color: #d4edda;
        }

        .run-btn-2 {
            background-color: #c3e6cb;
        }

        .run-btn-3 {
            background-color: #b8daff;
        }

        .run-btn-4 {
            background-color: #bee5eb;
        }

        .run-btn-5 {
            background-color: #ffeeba;
        }

        .run-btn-6 {
            background-color: #ffdf7e;
        }

        .special-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            flex: 1;
            margin-left: 10px;
        }

        .special-btn {
            padding: 15px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .special-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .wide-btn {
            background-color: #f8d7da;
            color: #721c24;
        }

        .noball-btn {
            background-color: #fff3cd;
            color: #856404;
        }

        .out-btn {
            background-color: #f5c6cb;
            color: #721c24;
        }

        .undo-btn {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .lb-btn {
            background-color: #e2e3e5;
            color: #383d41;
        }

        .player-management {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .add-player {
            flex: 1;
            margin-right: 10px;
        }

        .change-strike {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .strike-btn {
            padding: 10px;
            background-color: var(--accent);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            margin: 5px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .strike-btn:hover {
            transform: scale(1.1);
            background-color: #e6a800;
        }

        .match-summary {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.5rem;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        .innings-summary {
            margin-bottom: 30px;
        }

        .innings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(26, 42, 108, 0.1);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .innings-title {
            font-weight: 600;
            color: var(--primary);
        }

        .innings-score {
            font-weight: 700;
        }

        .batsman-row, .bowler-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .batsman-name, .bowler-name {
            flex: 2;
            font-weight: 600;
        }

        .batsman-runs, .bowler-wickets {
            flex: 1;
            text-align: right;
        }

        .result-message {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(40, 167, 69, 0.1);
            border-radius: 5px;
        }

        .next-inning-btn {
            display: block;
            width: 100%;
            margin-top: 20px;
        }

        .required-runs {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary);
            text-align: center;
            margin: 10px 0;
        }

        .player-entry-form {
            margin-bottom: 20px;
        }

        .player-list {
            margin-top: 20px;
        }

        .player-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .change-bowler-btn {
            margin-top: 10px;
            width: 100%;
        }

        .view-history-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .view-history-btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-20px);
            }
            60% {
                transform: translateY(-10px);
            }
        }

        .bounce {
            animation: bounce 1s;
        }

        .animated {
            animation-duration: 1s;
            animation-fill-mode: both;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .team-inputs {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-controls {
                flex-direction: column;
            }
            
            .runs-buttons, .special-buttons {
                grid-template-columns: repeat(2, 1fr);
                margin-bottom: 10px;
                margin-left: 0;
            }
            
            .player-management {
                flex-direction: column;
            }
            
            .add-player {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .change-strike {
                flex-direction: row;
                justify-content: center;
                gap: 20px;
            }

            .view-history-btn {
                bottom: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        /* Toss animation */
        .coin {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #fdbb2d, #e6a800);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin: 0 auto 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .coin-face {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
            transition: transform 1s;
        }

        .heads {
            transform: rotateY(0deg);
        }

        .tails {
            transform: rotateY(180deg);
        }

        .flipping .heads {
            transform: rotateY(180deg);
        }

        .flipping .tails {
            transform: rotateY(360deg);
        }

        /* Scorecard animations */
        .score-update {
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Ball animation */
        .ball-animation {
            position: fixed;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #fdbb2d, #e6a800);
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
        }

        /* Celebration animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Cricket Scorecard</h1>
            <div class="logo">Track your match like a pro!</div>
        </div>
    </header>

    <div class="container">
        <!-- Setup Screen -->
        <div class="setup-screen active-screen">
            <h2>Match Setup</h2>
            <div class="form-group">
                <label for="match-title">Match Title</label>
                <input type="text" id="match-title" placeholder="e.g., IPL 2023 - Match 1">
            </div>
            <div class="form-group">
                <label for="overs">Number of Overs</label>
                <select id="overs">
                    <option value="1">1 Over</option>
                    <option value="2">2 Overs</option>
                    <option value="3">3 Overs</option>
                    <option value="4">4 Overs</option>
                    <option value="5">5 Overs</option>
                    <option value="10">10 Overs</option>
                    <option value="20" selected>20 Overs</option>
                    <option value="50">50 Overs</option>
                </select>
            </div>
            <div class="team-inputs">
                <div class="team-input">
                    <div class="form-group">
                        <label for="team1-name">Team 1 Name</label>
                        <input type="text" id="team1-name" placeholder="e.g., Mumbai Indians">
                    </div>
                </div>
                <div class="team-input">
                    <div class="form-group">
                        <label for="team2-name">Team 2 Name</label>
                        <input type="text" id="team2-name" placeholder="e.g., Chennai Super Kings">
                    </div>
                </div>
            </div>
            <button id="setup-continue" class="btn">Continue</button>
        </div>

        <!-- Toss Screen -->
        <div class="toss-screen">
            <h2>Toss Time!</h2>
            <p>Which team won the toss and what did they choose?</p>
            
            <div class="coin" id="coin">
                <div class="coin-face heads">H</div>
                <div class="coin-face tails">T</div>
            </div>
            
            <div class="toss-options">
                <div class="toss-option" data-team="team1">
                    <i class="fas fa-users"></i>
                    <h3 id="team1-toss-name">Team 1</h3>
                    <p>Won the toss</p>
                </div>
                <div class="toss-option" data-team="team2">
                    <i class="fas fa-users"></i>
                    <h3 id="team2-toss-name">Team 2</h3>
                    <p>Won the toss</p>
                </div>
            </div>
            
            <div class="toss-decision" style="margin-top: 30px; display: none;">
                <h3>What did they choose?</h3>
                <div class="toss-options">
                    <div class="toss-option" data-choice="bat">
                        <i class="fas fa-baseball-ball"></i>
                        <h3>Batting</h3>
                        <p>Chose to bat first</p>
                    </div>
                    <div class="toss-option" data-choice="bowl">
                        <i class="fas fa-running"></i>
                        <h3>Bowling</h3>
                        <p>Chose to bowl first</p>
                    </div>
                </div>
            </div>
            
            <button id="toss-continue" class="btn" style="display: none; margin-top: 20px;">Continue</button>
        </div>

        <!-- Player Entry Screen -->
        <div class="player-entry-screen">
            <h2 id="player-entry-title">Enter Players for Team</h2>
            <div class="player-entry-form">
                <div class="form-group">
                    <label for="player-type">Player Type</label>
                    <select id="player-type">
                        <option value="batsman">Batsman</option>
                        <option value="bowler">Bowler</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="player-name">Player Name</label>
                    <div style="display: flex;">
                        <input type="text" id="player-name" placeholder="Enter player name">
                        <button id="add-player-btn" class="btn btn-accent" style="margin-left: 10px; padding: 0 15px;">Add</button>
                    </div>
                </div>
            </div>
            
            <div class="player-list" id="player-list">
                <!-- Players will be listed here -->
            </div>
            
            <button id="player-entry-continue" class="btn">Continue</button>
        </div>

        <!-- Scorecard Screen -->
        <div class="scorecard-screen">
            <div class="scorecard-header">
                <div id="match-title-display">Match Title</div>
                <div class="scorecard-teams">
                    <span id="batting-team-name">Team 1</span>
                    <span>vs</span>
                    <span id="bowling-team-name">Team 2</span>
                </div>
            </div>
            
            <div id="required-runs-display" class="required-runs" style="display: none;"></div>
            
            <div class="scorecard-stats">
                <div class="scorecard-stat">
                    <h3 id="current-score">0-0</h3>
                    <p>Runs-Wickets</p>
                </div>
                <div class="scorecard-stat">
                    <h3 id="current-overs">0.0</h3>
                    <p>Overs</p>
                </div>
                <div class="scorecard-stat">
                    <h3 id="run-rate">0.00</h3>
                    <p>Run Rate</p>
                </div>
                <div class="scorecard-stat" id="target-container" style="display: none;">
                    <h3 id="target-score">0</h3>
                    <p>Target</p>
                </div>
            </div>
            
            <div class="batsmen-container">
                <div class="batsman selected" id="batsman1">
                    <div class="batsman-name">Batsman 1</div>
                    <div class="batsman-runs">0</div>
                </div>
                <div class="batsman" id="batsman2">
                    <div class="batsman-name">Batsman 2</div>
                    <div class="batsman-runs">0</div>
                </div>
            </div>
            
            <div class="bowler-container">
                <div class="bowler selected" id="current-bowler">
                    <div class="bowler-name">Bowler</div>
                    <div class="bowler-stats">0-0-0-0</div>
                </div>
            </div>
            
            <button id="change-bowler-btn" class="btn btn-secondary change-bowler-btn">Change Bowler</button>
            <button id="change-batsman-btn" class="btn btn-secondary">Change Batsman</button>
            
            <div class="player-management">
                <div class="add-player">
                    <div class="form-group">
                        <label for="new-player-name">Add Player</label>
                        <div style="display: flex;">
                            <input type="text" id="new-player-name" placeholder="Player name">
                            <button id="add-batsman" class="btn btn-accent" style="margin-left: 10px; padding: 0 15px;">Add Batsman</button>
                            <button id="add-bowler" class="btn btn-secondary" style="margin-left: 10px; padding: 0 15px;">Add Bowler</button>
                        </div>
                    </div>
                </div>
                <div class="change-strike">
                    <button class="strike-btn" id="strike-up"><i class="fas fa-arrow-up"></i></button>
                    <div>Change Strike</div>
                    <button class="strike-btn" id="strike-down"><i class="fas fa-arrow-down"></i></button>
                </div>
            </div>
            
            <div class="score-controls">
                <div class="runs-buttons">
                    <button class="run-btn run-btn-0" data-runs="0">0</button>
                    <button class="run-btn run-btn-1" data-runs="1">1</button>
                    <button class="run-btn run-btn-2" data-runs="2">2</button>
                    <button class="run-btn run-btn-3" data-runs="3">3</button>
                    <button class="run-btn run-btn-4" data-runs="4">4</button>
                    <button class="run-btn run-btn-5" data-runs="5">5</button>
                    <button class="run-btn run-btn-6" data-runs="6">6</button>
                </div>
                <div class="special-buttons">
                    <button class="special-btn wide-btn" data-type="wide">Wide</button>
                    <button class="special-btn noball-btn" data-type="noball">No Ball</button>
                    <button class="special-btn lb-btn" data-type="lb">LB</button>
                    <button class="special-btn out-btn" data-type="out">Out</button>
                    <button class="special-btn undo-btn" id="undo-btn">Undo</button>
                </div>
            </div>
            
            <button id="end-innings" class="btn btn-secondary">End Innings</button>
        </div>

        <!-- Innings Result Screen -->
        <div class="innings-result-screen">
            <div class="match-summary">
                <div class="summary-header" id="innings-summary-title">Innings 1 Summary</div>
                
                <div class="innings-summary">
                    <div class="innings-header">
                        <div class="innings-title" id="innings1-team">Team 1</div>
                        <div class="innings-score" id="innings1-score">0-0 (0.0 Overs)</div>
                    </div>
                    
                    <h4>Batting</h4>
                    <div id="innings1-batting">
                        <!-- Batsmen will be added here -->
                    </div>
                    
                    <h4>Bowling</h4>
                    <div id="innings1-bowling">
                        <!-- Bowlers will be added here -->
                    </div>
                </div>
                
                <div id="innings2-summary" style="display: none;">
                    <div class="innings-header">
                        <div class="innings-title" id="innings2-team">Team 2</div>
                        <div class="innings-score" id="innings2-score">0-0 (0.0 Overs)</div>
                    </div>
                    
                    <h4>Batting</h4>
                    <div id="innings2-batting">
                        <!-- Batsmen will be added here -->
                    </div>
                    
                    <h4>Bowling</h4>
                    <div id="innings2-bowling">
                        <!-- Bowlers will be added here -->
                    </div>
                </div>
                
                <div id="match-result" style="display: none;">
                    <div class="result-message" id="result-message">
                        Team 1 won by X runs
                    </div>
                </div>
                
                <button id="next-inning-btn" class="btn next-inning-btn">Begin Innings 2</button>
                <button id="view-summary-btn" class="btn" style="display: none; margin-top: 10px;">View Match Summary</button>
                <button id="save-match-btn" class="btn btn-accent" style="display: none; margin-top: 10px;">Save Match Data</button>
            </div>
        </div>
    </div>

    <div class="ball-animation" id="ball-animation"></div>

    <a id="view-history-btn" class="view-history-btn" href="history.html">
        View History
      </a>
      
        <i class="fas fa-history"></i> View Match History
    </button>

    <script>
        // Match data
        const matchData = {
            title: '',
            overs: 20,
            team1: {
                name: '',
                players: [],
                batting: [],
                bowling: []
            },
            team2: {
                name: '',
                players: [],
                batting: [],
                bowling: []
            },
            toss: {
                winner: null,
                decision: null
            },
            currentInnings: 1,
            battingTeam: null,
            bowlingTeam: null,
            currentBatsmen: [],
            currentBowler: null,
            score: 0,
            wickets: 0,
            ballsBowled: 0,
            extras: 0,
            target: 0,
            history: [],
            allPlayersEntered: false
        };

        // DOM elements
        const setupScreen = document.querySelector('.setup-screen');
        const tossScreen = document.querySelector('.toss-screen');
        const playerEntryScreen = document.querySelector('.player-entry-screen');
        const scorecardScreen = document.querySelector('.scorecard-screen');
        const inningsResultScreen = document.querySelector('.innings-result-screen');
        
        const matchTitleInput = document.getElementById('match-title');
        const oversInput = document.getElementById('overs');
        const team1NameInput = document.getElementById('team1-name');
        const team2NameInput = document.getElementById('team2-name');
        const setupContinueBtn = document.getElementById('setup-continue');
        
        const team1TossName = document.getElementById('team1-toss-name');
        const team2TossName = document.getElementById('team2-toss-name');
        const tossOptions = document.querySelectorAll('.toss-option[data-team]');
        const decisionOptions = document.querySelectorAll('.toss-option[data-choice]');
        const tossDecisionDiv = document.querySelector('.toss-decision');
        const tossContinueBtn = document.getElementById('toss-continue');
        const coin = document.getElementById('coin');
        
        const playerEntryTitle = document.getElementById('player-entry-title');
        const playerTypeSelect = document.getElementById('player-type');
        const playerNameInput = document.getElementById('player-name');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const playerList = document.getElementById('player-list');
        const playerEntryContinueBtn = document.getElementById('player-entry-continue');
        
        const matchTitleDisplay = document.getElementById('match-title-display');
        const battingTeamName = document.getElementById('batting-team-name');
        const bowlingTeamName = document.getElementById('bowling-team-name');
        const requiredRunsDisplay = document.getElementById('required-runs-display');
        const currentScore = document.getElementById('current-score');
        const currentOvers = document.getElementById('current-overs');
        const runRate = document.getElementById('run-rate');
        const targetContainer = document.getElementById('target-container');
        const targetScore = document.getElementById('target-score');
        
        const batsman1 = document.getElementById('batsman1');
        const batsman2 = document.getElementById('batsman2');
        const currentBowlerDisplay = document.getElementById('current-bowler');
        const changeBowlerBtn = document.getElementById('change-bowler-btn');
        document.getElementById('change-batsman-btn').addEventListener('click', showBatsmanSelection);
        
        const newPlayerName = document.getElementById('new-player-name');
        const addBatsmanBtn = document.getElementById('add-batsman');
        const addBowlerBtn = document.getElementById('add-bowler');
        const strikeUpBtn = document.getElementById('strike-up');
        const strikeDownBtn = document.getElementById('strike-down');
        
        const runButtons = document.querySelectorAll('.run-btn');
        const wideBtn = document.querySelector('.wide-btn');
        const noballBtn = document.querySelector('.noball-btn');
        const lbBtn = document.querySelector('.lb-btn');
        const outBtn = document.querySelector('.out-btn');
        const undoBtn = document.getElementById('undo-btn');
        const endInningsBtn = document.getElementById('end-innings');
        
        const inningsSummaryTitle = document.getElementById('innings-summary-title');
        const innings1Team = document.getElementById('innings1-team');
        const innings1Score = document.getElementById('innings1-score');
        const innings1Batting = document.getElementById('innings1-batting');
        const innings1Bowling = document.getElementById('innings1-bowling');
        const innings2Summary = document.getElementById('innings2-summary');
        const innings2Team = document.getElementById('innings2-team');
        const innings2Score = document.getElementById('innings2-score');
        const innings2Batting = document.getElementById('innings2-batting');
        const innings2Bowling = document.getElementById('innings2-bowling');
        const matchResult = document.getElementById('match-result');
        const resultMessage = document.getElementById('result-message');
        const nextInningBtn = document.getElementById('next-inning-btn');
        const viewSummaryBtn = document.getElementById('view-summary-btn');
        const saveMatchBtn = document.getElementById('saveMatchBtn');
                const viewHistoryBtn = document.getElementById('view-history-btn');
        
        const ballAnimation = document.getElementById('ball-animation');

        // Game state
        let selectedBatsmanIndex = 0;
        let selectedBowlerIndex = 0;
        let currentTeamForPlayerEntry = null;
        let currentPlayerTypeForEntry = null;
        let batsmen = [];
        let bowlers = [];
        let currentBowler = null;
        let currentBatsmen = [];
        let innings1Data = null;
        let innings2Data = null;

        // Initialize the app
        function init() {
            setupContinueBtn.addEventListener('click', setupMatch);
            
            tossOptions.forEach(option => {
                option.addEventListener('click', selectTossWinner);
            });
            
            decisionOptions.forEach(option => {
                option.addEventListener('click', selectTossDecision);
            });
            
            tossContinueBtn.addEventListener('click', startPlayerEntry);
            
            addPlayerBtn.addEventListener('click', addPlayerToList);
            playerEntryContinueBtn.addEventListener('click', finishPlayerEntry);
            
            addBatsmanBtn.addEventListener('click', addNewBatsman);
            addBowlerBtn.addEventListener('click', addNewBowler);
            changeBowlerBtn.addEventListener('click', showBowlerSelection);
            
            strikeUpBtn.addEventListener('click', () => changeStrike('up'));
            strikeDownBtn.addEventListener('click', () => changeStrike('down'));
            
            runButtons.forEach(button => {
                button.addEventListener('click', () => addRuns(parseInt(button.dataset.runs)));
            });
            
            wideBtn.addEventListener('click', () => addExtra('wide'));
            noballBtn.addEventListener('click', () => addExtra('noball'));
            lbBtn.addEventListener('click', () => addExtra('lb'));
            outBtn.addEventListener('click', addWicket);
            undoBtn.addEventListener('click', undoLastAction);
            
            endInningsBtn.addEventListener('click', endInnings);
            
            nextInningBtn.addEventListener('click', startSecondInnings);
            viewSummaryBtn.addEventListener('click', viewSummary);
            saveMatchBtn.addEventListener('click', saveMatchData);
            viewHistoryBtn.addEventListener('click', viewMatchHistory);
        }

        // Setup match details
        function setupMatch() {
            if (!matchTitleInput.value || !team1NameInput.value || !team2NameInput.value) {
                alert('Please fill in all fields');
                return;
            }
            
            matchData.title = matchTitleInput.value;
            matchData.overs = parseInt(oversInput.value);
            matchData.team1.name = team1NameInput.value;
            matchData.team2.name = team2NameInput.value;
            
            // Update toss screen with team names
            team1TossName.textContent = matchData.team1.name;
            team2TossName.textContent = matchData.team2.name;
            
            // Hide setup screen and show toss screen
            setupScreen.classList.remove('active-screen');
            tossScreen.classList.add('active-screen');
            
            // Animate the coin
            setTimeout(() => {
                coin.classList.add('flipping');
                setTimeout(() => {
                    coin.classList.remove('flipping');
                }, 1000);
            }, 500);
        }

        // Select toss winner
        function selectTossWinner(e) {
            const selectedTeam = e.currentTarget.dataset.team;
            matchData.toss.winner = selectedTeam;
            
            // Update UI
            tossOptions.forEach(option => {
                option.classList.remove('selected');
            });
            e.currentTarget.classList.add('selected');
            
            // Show decision options
            tossDecisionDiv.style.display = 'block';
            
            // Reset decision selection
            decisionOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Hide continue button until decision is made
            tossContinueBtn.style.display = 'none';
        }

        // Select toss decision
        function selectTossDecision(e) {
            const decision = e.currentTarget.dataset.choice;
            matchData.toss.decision = decision;
            
            // Update UI
            decisionOptions.forEach(option => {
                option.classList.remove('selected');
            });
            e.currentTarget.classList.add('selected');
            
            // Show continue button
            tossContinueBtn.style.display = 'inline-block';
        }

        // Start player entry process
        function startPlayerEntry() {
            // Determine batting and bowling teams based on toss
            if (matchData.toss.winner === 'team1') {
                matchData.battingTeam = matchData.toss.decision === 'bat' ? matchData.team1 : matchData.team2;
                matchData.bowlingTeam = matchData.toss.decision === 'bat' ? matchData.team2 : matchData.team1;
            } else {
                matchData.battingTeam = matchData.toss.decision === 'bat' ? matchData.team2 : matchData.team1;
                matchData.bowlingTeam = matchData.toss.decision === 'bat' ? matchData.team1 : matchData.team2;
            }
            
            // Start with batting team players
            currentTeamForPlayerEntry = matchData.battingTeam;
            currentPlayerTypeForEntry = 'batsman';
            playerEntryTitle.textContent = `Enter Batsmen for ${currentTeamForPlayerEntry.name}`;
            playerList.innerHTML = '';
            playerNameInput.value = '';
            playerTypeSelect.value = 'batsman';
            
            // Hide toss screen and show player entry screen
            tossScreen.classList.remove('active-screen');
            playerEntryScreen.classList.add('active-screen');
        }

        // Add player to the list
        function addPlayerToList() {
            const name = playerNameInput.value.trim();
            const type = playerTypeSelect.value;
            
            if (!name) {
                alert('Please enter a player name');
                return;
            }
            
            // Add player to the current team
            const player = {
                name: name,
                type: type,
                runs: 0,
                balls: 0,
                fours: 0,
                sixes: 0,
                isOut: false,
                outDesc: '',
                overs: 0,
                maidens: 0,
                runsConceded: 0,
                wickets: 0,
                ballsBowled: 0
            };
            
            currentTeamForPlayerEntry.players.push(player);
            
            // Add to UI list
            const playerItem = document.createElement('div');
            playerItem.className = 'player-item';
            playerItem.innerHTML = `
                <span>${name}</span>
                <span>(${type === 'batsman' ? 'Batsman' : 'Bowler'})</span>
            `;
            playerList.appendChild(playerItem);
            
            // Clear input
            playerNameInput.value = '';
            playerNameInput.focus();
        }

        // Finish player entry for current team/type
        function finishPlayerEntry() {
            if (currentTeamForPlayerEntry.players.length === 0) {
                alert('Please add at least one player');
                return;
            }
            
            // Determine next step
            if (currentPlayerTypeForEntry === 'batsman' && currentTeamForPlayerEntry === matchData.battingTeam) {
                // Move to bowlers for batting team
                currentPlayerTypeForEntry = 'bowler';
                playerEntryTitle.textContent = `Enter Bowlers for ${currentTeamForPlayerEntry.name}`;
                playerList.innerHTML = '';
                playerNameInput.value = '';
                playerTypeSelect.value = 'bowler';
                return;
            } 
            
            if (currentPlayerTypeForEntry === 'bowler' && currentTeamForPlayerEntry === matchData.battingTeam) {
                // Move to bowling team's batsmen
                currentTeamForPlayerEntry = matchData.bowlingTeam;
                currentPlayerTypeForEntry = 'batsman';
                playerEntryTitle.textContent = `Enter Batsmen for ${currentTeamForPlayerEntry.name}`;
                playerList.innerHTML = '';
                playerNameInput.value = '';
                playerTypeSelect.value = 'batsman';
                return;
            }
            
            if (currentPlayerTypeForEntry === 'batsman' && currentTeamForPlayerEntry === matchData.bowlingTeam) {
                // Move to bowlers for bowling team
                currentPlayerTypeForEntry = 'bowler';
                playerEntryTitle.textContent = `Enter Bowlers for ${currentTeamForPlayerEntry.name}`;
                playerList.innerHTML = '';
                playerNameInput.value = '';
                playerTypeSelect.value = 'bowler';
                return;
            }
            
            // All players entered, start the match
            matchData.allPlayersEntered = true;
            startMatch();
        }

        // Start the match after player entry
        function startMatch() {
            // Initialize first two batsmen
            const battingTeamBatsmen = matchData.battingTeam.players.filter(p => p.type === 'batsman');
            if (battingTeamBatsmen.length < 2) {
                alert('Need at least 2 batsmen to start the match');
                return;
            }
            
            const batsman1 = JSON.parse(JSON.stringify(battingTeamBatsmen[0]));
            const batsman2 = JSON.parse(JSON.stringify(battingTeamBatsmen[1]));
            
            matchData.battingTeam.batting.push(batsman1, batsman2);
            matchData.currentBatsmen = [batsman1, batsman2];
            
            // Initialize first bowler
            const bowlingTeamBowlers = matchData.bowlingTeam.players.filter(p => p.type === 'bowler');
            if (bowlingTeamBowlers.length < 1) {
                alert('Need at least 1 bowler to start the match');
                return;
            }
            
            const bowler = JSON.parse(JSON.stringify(bowlingTeamBowlers[0]));
            matchData.bowlingTeam.bowling.push(bowler);
            matchData.currentBowler = bowler;
            
            // Update scorecard display
            updateScorecardDisplay();
            
            // Hide player entry screen and show scorecard screen
            playerEntryScreen.classList.remove('active-screen');
            scorecardScreen.classList.add('active-screen');
            
            // Animate transition
            scorecardScreen.classList.add('animated', 'bounce');
            setTimeout(() => {
                scorecardScreen.classList.remove('animated', 'bounce');
            }, 1000);
        }

        // Update scorecard display
        function updateScorecardDisplay() {
            matchTitleDisplay.textContent = matchData.title;
            battingTeamName.textContent = matchData.battingTeam.name;
            bowlingTeamName.textContent = matchData.bowlingTeam.name;
            
            // Update score
            currentScore.textContent = `${matchData.score}-${matchData.wickets}`;
            
            // Update overs
            const overs = Math.floor(matchData.ballsBowled / 6);
            const balls = matchData.ballsBowled % 6;
            currentOvers.textContent = `${overs}.${balls}`;
            
            // Update run rate
            const calculatedRunRate = matchData.ballsBowled > 0 ?
                (matchData.score / (matchData.ballsBowled / 6)).toFixed(2) : '0.00';
            runRate.textContent = calculatedRunRate;
            
            // Update target if it's the second innings
            if (matchData.currentInnings === 2) {
                targetContainer.style.display = 'block';
                targetScore.textContent = matchData.target;
                
                // Calculate required runs
                const ballsLeft = (matchData.overs * 6) - matchData.ballsBowled;
                const runsNeeded = matchData.target - matchData.score;
                
                if (runsNeeded > 0) {
                    requiredRunsDisplay.style.display = 'block';
                    requiredRunsDisplay.textContent = `Need ${runsNeeded} runs in ${ballsLeft} balls`;
                } else {
                    requiredRunsDisplay.style.display = 'none';
                }
            } else {
                targetContainer.style.display = 'none';
                requiredRunsDisplay.style.display = 'none';
            }
            
            // Update batsmen
            if (matchData.currentBatsmen.length > 0) {
                batsman1.querySelector('.batsman-name').textContent = matchData.currentBatsmen[0].name;
                batsman1.querySelector('.batsman-runs').textContent = matchData.currentBatsmen[0].runs;
                
                if (matchData.currentBatsmen.length > 1) {
                    batsman2.querySelector('.batsman-name').textContent = matchData.currentBatsmen[1].name;
                    batsman2.querySelector('.batsman-runs').textContent = matchData.currentBatsmen[1].runs;
                }
            }
            
            // Update bowler
            if (matchData.currentBowler) {
                currentBowlerDisplay.querySelector('.bowler-name').textContent = matchData.currentBowler.name;
                const bowlerStats = `${matchData.currentBowler.overs}.${matchData.currentBowler.balls % 6}-${matchData.currentBowler.maidens}-${matchData.currentBowler.runs}-${matchData.currentBowler.wickets}`;
                currentBowlerDisplay.querySelector('.bowler-stats').textContent = bowlerStats;
            }
            
            // Highlight selected batsman
            batsman1.classList.toggle('selected', selectedBatsmanIndex === 0);
            batsman2.classList.toggle('selected', selectedBatsmanIndex === 1);
        }

        // Add new batsman during the match
        function addNewBatsman() {
            const name = newPlayerName.value.trim();
            if (!name) {
                alert('Please enter a player name');
                return;
            }
            
            const newBatsman = {
                name: name,
                type: 'batsman',
                runs: 0,
                balls: 0,
                fours: 0,
                sixes: 0,
                isOut: false,
                outDesc: ''
            };
            
            matchData.battingTeam.batting.push(newBatsman);
            matchData.battingTeam.players.push(newBatsman);
            
            // If we have less than 2 batsmen at the crease, add this one
            if (matchData.currentBatsmen.length < 2) {
                matchData.currentBatsmen.push(newBatsman);
                updateScorecardDisplay();
            }
            
            newPlayerName.value = '';
            
            // Animate the addition
            const batsmenContainer = document.querySelector('.batsmen-container');
            batsmenContainer.classList.add('score-update');
            setTimeout(() => {
                batsmenContainer.classList.remove('score-update');
            }, 500);
        }

        // Add new bowler during the match
        function addNewBowler() {
            const name = newPlayerName.value.trim();
            if (!name) {
                alert('Please enter a player name');
                return;
            }
            
            const newBowler = {
                name: name,
                type: 'bowler',
                overs: 0,
                maidens: 0,
                runs: 0,
                wickets: 0,
                balls: 0
            };
            
            matchData.bowlingTeam.bowling.push(newBowler);
            matchData.bowlingTeam.players.push(newBowler);
            newPlayerName.value = '';
            
            // Animate the addition
            const bowlerContainer = document.querySelector('.bowler-container');
            bowlerContainer.classList.add('score-update');
            setTimeout(() => {
                bowlerContainer.classList.remove('score-update');
            }, 500);
        }

        // Show bowler selection dialog
        function showBowlerSelection() {
            const availableBowlers = matchData.bowlingTeam.bowling.filter(bowler => 
                !matchData.currentBowler || bowler.name !== matchData.currentBowler.name
            );
            
            if (availableBowlers.length === 0) {
                alert('No other bowlers available');
                return;
            }
            
            const bowlerNames = availableBowlers.map(bowler => bowler.name).join('\n');
            const selectedBowlerName = prompt(`Available bowlers:\n${bowlerNames}\n\nEnter bowler name:`);
            
            if (selectedBowlerName) {
                const selectedBowler = matchData.bowlingTeam.bowling.find(bowler => 
                    bowler.name === selectedBowlerName.trim()
                );
                
                if (selectedBowler) {
                    matchData.currentBowler = selectedBowler;
                    updateScorecardDisplay();
                } else {
                    alert('Bowler not found');
                }
            }
        }
        function showBatsmanSelection() {
    const availableBatsmen = matchData.battingTeam.batting.filter(batsman => 
        !batsman.isOut && !matchData.currentBatsmen.includes(batsman)
    );

    if (availableBatsmen.length === 0) {
        alert('No other batsmen available');
        return;
    }

    const batsmanNames = availableBatsmen.map(batsman => batsman.name).join('\n');
    const selectedBatsmanName = prompt(`Available batsmen:\n${batsmanNames}\n\nEnter batsman name:`);

    if (selectedBatsmanName) {
        const selectedBatsman = matchData.battingTeam.batting.find(batsman => 
            batsman.name === selectedBatsmanName.trim()
        );

        if (selectedBatsman) {
            // Save current state for undo
            saveState();

            // Replace current batsman
            matchData.currentBatsmen[selectedBatsmanIndex] = selectedBatsman;
            updateScorecardDisplay();
        } else {
            alert('Batsman not found');
        }
    }
}

        // Change strike between batsmen
        function changeStrike(direction) {
            if (matchData.currentBatsmen.length < 2) return;
            
            selectedBatsmanIndex = direction === 'up' ? 0 : 1;
            updateScorecardDisplay();
            
            // Animate the strike change
            animateBall(direction);
        }

        // Add runs to the score
        function addRuns(runs) {
            if (matchData.currentBatsmen.length === 0) return;
            
            // Save current state for undo
            saveState();
            
            // Update batsman stats
            const batsman = matchData.currentBatsmen[selectedBatsmanIndex];
            batsman.runs += runs;
            batsman.balls++;
            
            if (runs === 4) batsman.fours++;
            if (runs === 6) batsman.sixes++;
            
            // Update team score
            matchData.score += runs;
            
            // Update bowler stats
            matchData.currentBowler.runs += runs;
            matchData.currentBowler.balls++;
            
            
            
            // Check for maiden over
            if (matchData.currentBowler.balls % 6 === 0) {
                if (matchData.currentBowler.runs === 0) {
                    matchData.currentBowler.maidens++;
                }
                matchData.currentBowler.overs = Math.floor(matchData.currentBowler.balls / 6);
                // Rotate strike at the end of over
                if (matchData.currentBatsmen.length > 1) {
                    selectedBatsmanIndex = selectedBatsmanIndex === 0 ? 1 : 0;
                }
            }
            
            // Update total balls bowled
            matchData.ballsBowled++;
            
            // Change strike if odd number of runs
            if (runs % 2 !== 0 && matchData.currentBatsmen.length > 1) {
                selectedBatsmanIndex = selectedBatsmanIndex === 0 ? 1 : 0;
            }
            
            // Update display
            updateScorecardDisplay();
            
            // Animate the runs
            animateRuns(runs);
            
            // Check if innings is complete (all out or overs completed or target achieved in 2nd innings)
            checkInningsComplete();
        }

        // Add extra runs (wide, no ball or leg bye)
        function addExtra(type) {
            // Save current state for undo
            saveState();
            
            let runsToAdd = 1;
            let updateBatsman = true;
            
            switch (type) {
                case 'wide':
                    // Wide doesn't count as a ball faced by batsman
                    updateBatsman = false;
                    break;
                case 'noball':
                    // No ball doesn't count as a legal delivery
                    updateBatsman = false;
                    break;
                case 'lb':
                    // Leg bye - runs count but not against batsman
                    updateBatsman = false;
                    break;
            }
            
            // Update team score
            matchData.score += runsToAdd;
            matchData.extras += runsToAdd;
            
            // Update bowler stats
            matchData.currentBowler.runs += runsToAdd;
            if (type !== 'noball') {
                matchData.currentBowler.balls++;
            }
            
            // Update batsman stats if needed
            if (updateBatsman && matchData.currentBatsmen.length > 0) {
                const batsman = matchData.currentBatsmen[selectedBatsmanIndex];
                batsman.balls++;
            }
            
            // Check for maiden over
            if (matchData.currentBowler.balls % 6 === 0 && type !== 'noball') {
                if (matchData.currentBowler.runs === 0) {
                    matchData.currentBowler.maidens++;
                }
                matchData.currentBowler.overs = Math.floor(matchData.currentBowler.balls / 6);
                // Rotate strike at the end of over
                if (matchData.currentBatsmen.length > 1) {
                    selectedBatsmanIndex = selectedBatsmanIndex === 0 ? 1 : 0;
                }
            }
            
            // Update total balls bowled
            if (type !== 'noball') {
                matchData.ballsBowled++;
            }
            
            // Update display
            updateScorecardDisplay();
            
            // Animate the extra
            animateExtra(type);
            
            // Check if innings is complete
            checkInningsComplete();
        }

        // Add wicket
        function addWicket() {
            if (matchData.currentBatsmen.length === 0 || matchData.wickets >= 10) return;
            
            // Save current state for undo
            saveState();
            
            // Update batsman stats
            const batsman = matchData.currentBatsmen[selectedBatsmanIndex];
            batsman.isOut = true;
            batsman.outDesc = `b ${matchData.currentBowler.name}`;
            
            // Update team wickets
            matchData.wickets++;
            
            // Update bowler stats
            matchData.currentBowler.wickets++;
            matchData.currentBowler.balls++;
            
            // Check for maiden over
            if (matchData.currentBowler.balls % 6 === 0) {
                if (matchData.currentBowler.runs === 0) {
                    matchData.currentBowler.maidens++;
                }
                matchData.currentBowler.overs = Math.floor(matchData.currentBowler.balls / 6);
                // Rotate strike at the end of over
                if (matchData.currentBatsmen.length > 1) {
                    selectedBatsmanIndex = selectedBatsmanIndex === 0 ? 1 : 0;
                }
            }
            
            // Update total balls bowled
            matchData.ballsBowled++;
            
            // Find next batsman
            const nextBatsman = matchData.battingTeam.batting.find(player => 
                !player.isOut && !matchData.currentBatsmen.includes(player)
            );
            
            if (nextBatsman) {
                // Replace out batsman with new batsman
                matchData.currentBatsmen[selectedBatsmanIndex] = nextBatsman;
            } else {
                // No more batsmen, remove from current batsmen
                matchData.currentBatsmen.splice(selectedBatsmanIndex, 1);
                
                // If only one batsman left, select them
                if (matchData.currentBatsmen.length === 1) {
                    selectedBatsmanIndex = 0;
                }
            }
            
            // Update display
            updateScorecardDisplay();
            
            // Animate the wicket
            animateWicket();
            
            // Check if innings is complete
            checkInningsComplete();
        }

        // Undo last action
        function undoLastAction() {
            if (matchData.history.length === 0) return;
            
            const lastState = matchData.history.pop();
            
            // Restore match data
            matchData.score = lastState.score;
            matchData.wickets = lastState.wickets;
            matchData.ballsBowled = lastState.ballsBowled;
            matchData.extras = lastState.extras;
            
            // Restore current batsmen
            matchData.currentBatsmen = lastState.currentBatsmen;
            selectedBatsmanIndex = lastState.selectedBatsmanIndex;
            
            // Restore current bowler
            matchData.currentBowler = lastState.currentBowler;
            
            // Restore batting team data
            matchData.battingTeam.batting = lastState.battingTeam.batting;
            
            // Restore bowling team data
            matchData.bowlingTeam.bowling = lastState.bowlingTeam.bowling;
            
            // Update display
            updateScorecardDisplay();
            
            // Show undo animation
            document.querySelector('.scorecard-header').classList.add('score-update');
            setTimeout(() => {
                document.querySelector('.scorecard-header').classList.remove('score-update');
            }, 500);
        }

        // Save current state for undo
        function saveState() {
            const state = {
                score: matchData.score,
                wickets: matchData.wickets,
                ballsBowled: matchData.ballsBowled,
                extras: matchData.extras,
                currentBatsmen: JSON.parse(JSON.stringify(matchData.currentBatsmen)),
                selectedBatsmanIndex: selectedBatsmanIndex,
                currentBowler: JSON.parse(JSON.stringify(matchData.currentBowler)),
                battingTeam: {
                    batting: JSON.parse(JSON.stringify(matchData.battingTeam.batting))
                },
                bowlingTeam: {
                    bowling: JSON.parse(JSON.stringify(matchData.bowlingTeam.bowling))
                }
            };
            
            matchData.history.push(state);
            
            // Limit history to prevent memory issues
            if (matchData.history.length > 10) {
                matchData.history.shift();
            }
        }

        // Check if innings is complete
        function checkInningsComplete() {
            const totalOvers = matchData.overs;
            const oversBowled = Math.floor(matchData.ballsBowled / 6);
            const ballsBowled = matchData.ballsBowled % 6;
            
            // Check conditions for innings completion
            let inningsComplete = false;
            let reason = '';
            
            if (matchData.wickets >= 10) {
                inningsComplete = true;
                reason = 'All out';
            } else if (oversBowled >= totalOvers && ballsBowled >= 0) {
                inningsComplete = true;
                reason = 'Overs completed';
            } else if (matchData.currentInnings === 2 && matchData.score >= matchData.target) {
                inningsComplete = true;
                reason = 'Target achieved';
            }
            
            if (inningsComplete) {
                // Small delay to allow animation to complete
                setTimeout(() => {
                    endInnings();
                }, 1000);
            }
        }

        // End current innings
        function endInnings() {
            // Save innings data
            if (matchData.currentInnings === 1) {
                innings1Data = {
                    team: matchData.battingTeam.name,
                    score: matchData.score,
                    wickets: matchData.wickets,
                    overs: `${Math.floor(matchData.ballsBowled / 6)}.${matchData.ballsBowled % 6}`,
                    batting: JSON.parse(JSON.stringify(matchData.battingTeam.batting)),
                    bowling: JSON.parse(JSON.stringify(matchData.bowlingTeam.bowling))
                };
                
                // Set target for second innings
                matchData.target = matchData.score + 1;
            } else {
                innings2Data = {
                    team: matchData.battingTeam.name,
                    score: matchData.score,
                    wickets: matchData.wickets,
                    overs: `${Math.floor(matchData.ballsBowled / 6)}.${matchData.ballsBowled % 6}`,
                    batting: JSON.parse(JSON.stringify(matchData.battingTeam.batting)),
                    bowling: JSON.parse(JSON.stringify(matchData.bowlingTeam.bowling))
                };
                
                // Automatically save match data when 2nd innings ends
                saveMatchData();
            }
            
            // Show innings result screen
            showInningsResult();
        }

        // Show innings result
        function showInningsResult() {
            // Hide scorecard screen and show result screen
            scorecardScreen.classList.remove('active-screen');
            inningsResultScreen.classList.add('active-screen');
            
            if (matchData.currentInnings === 1) {
                // First innings result
                inningsSummaryTitle.textContent = 'Innings 1 Summary';
                innings1Team.textContent = innings1Data.team;
                innings1Score.textContent = `${innings1Data.score}-${innings1Data.wickets} (${innings1Data.overs} Overs)`;
                
                // Add batsmen
                innings1Batting.innerHTML = '';
                innings1Data.batting.forEach(batsman => {
                    const div = document.createElement('div');
                    div.className = 'batsman-row';
                    div.innerHTML = `
                        <div class="batsman-name">${batsman.name} ${batsman.isOut ? `(${batsman.outDesc})` : 'not out'}</div>
                        <div class="batsman-runs">${batsman.runs} (${batsman.balls}) ${batsman.fours > 0 ? `${batsman.fours}x4` : ''} ${batsman.sixes > 0 ? `${batsman.sixes}x6` : ''}</div>
                    `;
                    innings1Batting.appendChild(div);
                });
                
                // Add bowlers
                innings1Bowling.innerHTML = '';
                innings1Data.bowling.forEach(bowler => {
                    const div = document.createElement('div');
                    div.className = 'bowler-row';
                    div.innerHTML = `
                        <div class="bowler-name">${bowler.name}</div>
                        <div class="bowler-wickets">${bowler.overs}.${bowler.balls % 6}-${bowler.maidens}-${bowler.runs}-${bowler.wickets}</div>
                    `;
                    innings1Bowling.appendChild(div);
                });
                
                // Show next inning button
                nextInningBtn.style.display = 'block';
                nextInningBtn.textContent = 'Begin Innings 2';
                viewSummaryBtn.style.display = 'none';
                matchResult.style.display = 'none';
                innings2Summary.style.display = 'none';
                saveMatchBtn.style.display = 'none';
            } else {
                // Second innings result
                inningsSummaryTitle.textContent = 'Match Summary';
                innings1Team.textContent = innings1Data.team;
                innings1Score.textContent = `${innings1Data.score}-${innings1Data.wickets} (${innings1Data.overs} Overs)`;
                
                // Add first innings batsmen
                innings1Batting.innerHTML = '';
                innings1Data.batting.forEach(batsman => {
                    const div = document.createElement('div');
                    div.className = 'batsman-row';
                    div.innerHTML = `
                        <div class="batsman-name">${batsman.name} ${batsman.isOut ? `(${batsman.outDesc})` : 'not out'}</div>
                        <div class="batsman-runs">${batsman.runs} (${batsman.balls}) ${batsman.fours > 0 ? `${batsman.fours}x4` : ''} ${batsman.sixes > 0 ? `${batsman.sixes}x6` : ''}</div>
                    `;
                    innings1Batting.appendChild(div);
                });
                
                // Add first innings bowlers
                innings1Bowling.innerHTML = '';
                innings1Data.bowling.forEach(bowler => {
                    const div = document.createElement('div');
                    div.className = 'bowler-row';
                    div.innerHTML = `
                        <div class="bowler-name">${bowler.name}</div>
                        <div class="bowler-wickets">${bowler.overs}.${bowler.balls % 6}-${bowler.maidens}-${bowler.runs}-${bowler.wickets}</div>
                    `;
                    innings1Bowling.appendChild(div);
                });
                
                // Show second innings summary
                innings2Summary.style.display = 'block';
                innings2Team.textContent = innings2Data.team;
                innings2Score.textContent = `${innings2Data.score}-${innings2Data.wickets} (${innings2Data.overs} Overs)`;
                
                // Add second innings batsmen
                innings2Batting.innerHTML = '';
                innings2Data.batting.forEach(batsman => {
                    const div = document.createElement('div');
                    div.className = 'batsman-row';
                    div.innerHTML = `
                        <div class="batsman-name">${batsman.name} ${batsman.isOut ? `(${batsman.outDesc})` : 'not out'}</div>
                        <div class="batsman-runs">${batsman.runs} (${batsman.balls}) ${batsman.fours > 0 ? `${batsman.fours}x4` : ''} ${batsman.sixes > 0 ? `${batsman.sixes}x6` : ''}</div>
                    `;
                    innings2Batting.appendChild(div);
                });
                
                // Add second innings bowlers
                innings2Bowling.innerHTML = '';
                innings2Data.bowling.forEach(bowler => {
                    const div = document.createElement('div');
                    div.className = 'bowler-row';
                    div.innerHTML = `
                        <div class="bowler-name">${bowler.name}</div>
                        <div class="bowler-wickets">${bowler.overs}.${bowler.balls % 6}-${bowler.maidens}-${bowler.runs}-${bowler.wickets}</div>
                    `;
                    innings2Bowling.appendChild(div);
                });
                
                // Determine result
                let resultText = '';
                if (innings2Data.score > innings1Data.score) {
                    const wicketsLeft = 10 - innings2Data.wickets;
                    resultText = `${innings2Data.team} won by ${wicketsLeft} wicket${wicketsLeft !== 1 ? 's' : ''}`;
                } else if (innings2Data.score < innings1Data.score) {
                    const runsDiff = innings1Data.score - innings2Data.score;
                    resultText = `${innings1Data.team} won by ${runsDiff} run${runsDiff !== 1 ? 's' : ''}`;
                } else {
                    resultText = 'Match tied';
                }
                
                resultMessage.textContent = resultText;
                matchResult.style.display = 'block';
                
                // Show view summary and save buttons
                nextInningBtn.style.display = 'none';
                viewSummaryBtn.style.display = 'block';
                saveMatchBtn.style.display = 'block';
            }
            
            // Animate the result screen
            inningsResultScreen.classList.add('animated', 'bounce');
            setTimeout(() => {
                inningsResultScreen.classList.remove('animated', 'bounce');
            }, 1000);
        }

        // Start second innings
        function startSecondInnings() {
            // Swap batting and bowling teams
            const temp = matchData.battingTeam;
            matchData.battingTeam = matchData.bowlingTeam;
            matchData.bowlingTeam = temp;
            
            // Reset match data for second innings
            matchData.currentInnings = 2;
            matchData.score = 0;
            matchData.wickets = 0;
            matchData.ballsBowled = 0;
            matchData.extras = 0;
            matchData.currentBatsmen = [];
            matchData.history = [];
            
            // Initialize first two batsmen from the batting team's players
            const battingTeamBatsmen = matchData.battingTeam.players.filter(p => p.type === 'batsman');
            if (battingTeamBatsmen.length < 2) {
                alert('Need at least 2 batsmen to start the innings');
                return;
            }
            
            const batsman1 = JSON.parse(JSON.stringify(battingTeamBatsmen[0]));
            const batsman2 = JSON.parse(JSON.stringify(battingTeamBatsmen[1]));
            
            matchData.battingTeam.batting = [batsman1, batsman2];
            matchData.currentBatsmen = [batsman1, batsman2];
            selectedBatsmanIndex = 0;
            
            // Initialize first bowler from bowling team's players
            const bowlingTeamBowlers = matchData.bowlingTeam.players.filter(p => p.type === 'bowler');
            if (bowlingTeamBowlers.length < 1) {
                alert('Need at least 1 bowler to start the innings');
                return;
            }
            
            const bowler = JSON.parse(JSON.stringify(bowlingTeamBowlers[0]));
            matchData.bowlingTeam.bowling = [bowler];
            matchData.currentBowler = bowler;
            
            // Update display
            updateScorecardDisplay();
            
            // Hide result screen and show scorecard screen
            inningsResultScreen.classList.remove('active-screen');
            scorecardScreen.classList.add('active-screen');
            
            // Animate transition
            scorecardScreen.classList.add('animated', 'bounce');
            setTimeout(() => {
                scorecardScreen.classList.remove('animated', 'bounce');
            }, 1000);
        }

        // View summary
        function viewSummary() {
            // Just show the summary again (it's already populated)
            inningsResultScreen.classList.remove('active-screen');
            inningsResultScreen.classList.add('active-screen');
        }

        function saveMatchData() {
    // Ensure team names are correctly assigned if missing
    if (!innings1Data.team || !innings2Data.team) {
        innings1Data.team = matchData.battingFirst;
        innings2Data.team = (matchData.team1 === matchData.battingFirst) ? matchData.team2 : matchData.team1;
    }

    // Calculate result if both innings are complete
    let result = "Match in progress";
    if (matchData.currentInnings === 2 && innings1Data && innings2Data) {
        if (innings2Data.score > innings1Data.score) {
            const wicketsLeft = 10 - innings2Data.wickets;
            result = `${innings2Data.team} won by ${wicketsLeft} wicket${wicketsLeft !== 1 ? 's' : ''}`;
        } else if (innings2Data.score < innings1Data.score) {
            const runsDiff = innings1Data.score - innings2Data.score;
            result = `${innings1Data.team} won by ${runsDiff} run${runsDiff !== 1 ? 's' : ''}`;
        } else {
            result = 'Match tied';
        }
    }

    // Prepare match summary
    const matchSummary = {
        title: matchData.title,
        overs: matchData.overs,
        team1: matchData.team1,
        team2: matchData.team2,
        toss: matchData.toss,
        battingFirst: matchData.battingFirst,
        innings1: innings1Data,
        innings2: innings2Data,
        timestamp: new Date().toISOString(),
        result: result
    };

    // Save to localStorage
    const savedMatches = JSON.parse(localStorage.getItem('cricketMatches')) || [];
    savedMatches.push(matchSummary);
    localStorage.setItem('cricketMatches', JSON.stringify(savedMatches));

    alert('Match data saved successfully!');
}



        // View match history
        function viewMatchHistory() {
            window.location.href = "history.html";
        }

        // Animation functions
        function animateBall(direction) {
            const startX = direction === 'up' ? 50 : 50;
            const startY = direction === 'up' ? 60 : 40;
            const endX = direction === 'up' ? 50 : 50;
            const endY = direction === 'up' ? 40 : 60;
            
            ballAnimation.style.display = 'block';
            ballAnimation.style.left = `${startX}%`;
            ballAnimation.style.top = `${startY}%`;
            
            setTimeout(() => {
                ballAnimation.style.left = `${endX}%`;
                ballAnimation.style.top = `${endY}%`;
                
                setTimeout(() => {
                    ballAnimation.style.display = 'none';
                }, 300);
            }, 10);
        }

        function animateRuns(runs) {
            const colors = {
                0: '#6c757d',
                1: '#28a745',
                2: '#20c997',
                3: '#17a2b8',
                4: '#007bff',
                5: '#6610f2',
                6: '#fd7e14'
            };
            
            const runDisplay = document.createElement('div');
            runDisplay.textContent = runs;
            runDisplay.style.position = 'fixed';
            runDisplay.style.fontSize = '3rem';
            runDisplay.style.fontWeight = 'bold';
            runDisplay.style.color = colors[runs] || '#000';
            runDisplay.style.zIndex = '1000';
            runDisplay.style.left = '50%';
            runDisplay.style.top = '30%';
            runDisplay.style.transform = 'translate(-50%, -50%)';
            runDisplay.style.opacity = '1';
            runDisplay.style.textShadow = '0 0 10px rgba(0,0,0,0.5)';
            document.body.appendChild(runDisplay);
            
            let opacity = 1;
            let size = 3;
            const interval = setInterval(() => {
                opacity -= 0.05;
                size += 0.1;
                runDisplay.style.opacity = opacity;
                runDisplay.style.fontSize = `${size}rem`;
                runDisplay.style.top = `${parseFloat(runDisplay.style.top) - 1}%`;
                
                if (opacity <= 0) {
                    clearInterval(interval);
                    document.body.removeChild(runDisplay);
                }
            }, 50);
        }

        function animateExtra(type) {
            const textMap = {
                wide: 'WD',
                noball: 'NB',
                lb: 'LB'
            };
            const colorMap = {
                wide: '#dc3545',
                noball: '#ffc107',
                lb: '#383d41'
            };
            
            const extraDisplay = document.createElement('div');
            extraDisplay.textContent = textMap[type];
            extraDisplay.style.position = 'fixed';
            extraDisplay.style.fontSize = '2rem';
            extraDisplay.style.fontWeight = 'bold';
            extraDisplay.style.color = colorMap[type];
            extraDisplay.style.zIndex = '1000';
            extraDisplay.style.left = '50%';
            extraDisplay.style.top = '40%';
            extraDisplay.style.transform = 'translate(-50%, -50%)';
            extraDisplay.style.opacity = '1';
            document.body.appendChild(extraDisplay);
            
            let opacity = 1;
            const interval = setInterval(() => {
                opacity -= 0.05;
                extraDisplay.style.opacity = opacity;
                extraDisplay.style.top = `${parseFloat(extraDisplay.style.top) - 1}%`;
                
                if (opacity <= 0) {
                    clearInterval(interval);
                    document.body.removeChild(extraDisplay);
                }
            }, 50);
        }

        function animateWicket() {
            const wicketDisplay = document.createElement('div');
            wicketDisplay.innerHTML = '<i class="fas fa-times-circle"></i>';
            wicketDisplay.style.position = 'fixed';
            wicketDisplay.style.fontSize = '3rem';
            wicketDisplay.style.color = '#dc3545';
            wicketDisplay.style.zIndex = '1000';
            wicketDisplay.style.left = '50%';
            wicketDisplay.style.top = '50%';
            wicketDisplay.style.transform = 'translate(-50%, -50%)';
            wicketDisplay.style.opacity = '1';
            document.body.appendChild(wicketDisplay);
            
            let opacity = 1;
            let size = 3;
            const interval = setInterval(() => {
                opacity -= 0.05;
                size += 0.1;
                wicketDisplay.style.opacity = opacity;
                wicketDisplay.style.fontSize = `${size}rem`;
                
                if (opacity <= 0) {
                    clearInterval(interval);
                    document.body.removeChild(wicketDisplay);
                }
            }, 50);
            
            // Create confetti effect
            createConfetti();
        }

        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                
                // Animate confetti
                const angle = Math.random() * Math.PI * 2;
                const velocity = 5 + Math.random() * 5;
                const rotationSpeed = (Math.random() - 0.5) * 20;
                let rotation = 0;
                
                let posX = parseFloat(confetti.style.left);
                let posY = parseFloat(confetti.style.top);
                let opacity = 1;
                
                const interval = setInterval(() => {
                    posX += Math.cos(angle) * 0.5;
                    posY += Math.sin(angle) * 0.5 + 0.7;
                    rotation += rotationSpeed;
                    opacity -= 0.02;
                    
                    confetti.style.left = `${posX}%`;
                    confetti.style.top = `${posY}%`;
                    confetti.style.transform = `rotate(${rotation}deg)`;
                    confetti.style.opacity = opacity;
                    
                    if (opacity <= 0 || posY > 100) {
                        clearInterval(interval);
                        document.body.removeChild(confetti);
                    }
                }, 50);
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
              
